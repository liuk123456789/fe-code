<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <div class="name"></div>
    <button class="add">add</button>
    <span id="count"></span>
</body>
<!-- https://www.netlify.com/blog/2019/03/11/deep-dive-how-do-react-hooks-really-work/ -->
<!-- https://overreacted.io/zh-hans/a-complete-guide-to-useeffect/ -->
<!--https://overreacted.io/zh-hans/react-as-a-ui-runtime/-->
<!-- https://github.com/brickspert/blog/issues/26 -->
<!-- https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e -->
<script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
<script>
    let HOOKS = [];
    function render() {
        let currentIndex = 0;
        function useState(initialValue) {
            HOOKS[currentIndex] = HOOKS[currentIndex] || initialValue;
            const memoryCurrentIndex = currentIndex; // currentIndex 是全局可变的，需要保存本次的
            const setState = newState => {
                HOOKS[memoryCurrentIndex] = newState;
                render();
            }
            return [HOOKS[currentIndex++], setState];
        }
        function useEffect(fn, deps) {
            const _deps = HOOKS[currentIndex];
            const hasChange = _deps ? !deps.every((v, i) => _deps[i] === v) : true;
            if (!deps || hasChange) {
                setTimeout(() => {
                    fn();
                })
                HOOKS[currentIndex++] = deps;
            }
        }
        const [count, setCount] = useState(0);
        const [name, setName] = useState('hi');
        // $('.add').on('click', () => { // 重新绑定需要解绑之前的
        //     setCount(count + 1);
        // })
        $('.add')[0].onclick = () => { // 重复绑定会覆盖之前的
            setCount(count + 1);
            setName(name + 'ha');
        }
        $('#count').html(count);
        $('.name').html(name);
    }
    render();
</script>
</html>